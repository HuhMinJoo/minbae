<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
<body>
{{>layout/category/category_header}}
<hr>

{{#store_list}}
    <a href="/user/store/detail/{{categoryKo}}/{{store_idx}}/{{type}}">
        <ul>
            <li>가게 이미지 : {{store_detail_info_img}}</li>
            <li>가게 이름:{{store_name}}</li>
            <li>
                별점 :
                {{#starAvg}}
                    {{starAvg}}
                {{/starAvg}}
                {{^starAvg}}
                    0
                {{/starAvg}}
            </li>
            <li>최소 주문 : {{store_detail_minimum_price}}</li>
            <li>배달팁 : {{store_detail_deliver_price}}</li>
        </ul>
    </a>
{{/store_list}}
{{>user/shopping_visible}}
<hr>
<div id="storeListDiv"></div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    var user_lat=JSON.parse(window.localStorage.getItem("user_latlng")).user_lat;
    var user_lng=JSON.parse(window.localStorage.getItem("user_latlng")).user_lng;
    var resultdata;

    $('#body').on('load',requestStandardStoreList());

    window.onscroll = function(e) {
        if((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
            requestStandardStoreList();
            page++;
        }
    }

    function requestStandardStoreList(){
        $.ajax({
            type: 'GET',
            url: '/user/category/standard?paging='+page+'&user_lat='+user_lat+'&user_lng='+user_lng+'&category='+category,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
        }).done(function (data) {
            if(data!=null&&data.length>0){
                for(var i=0;i<data.length;i++){
                    var form = document.createElement("form");
                    var div = document.createElement("div");
                    var div1 = document.createElement("div");
                    var div2 = document.createElement("div");
                    var div3 = document.createElement("div");
                    var div4 = document.createElement("div");
                    div.style.marginTop="40px";
                    div.style.border="1px solid black";
                    div1.innerText=data[i].store_detail_info_img;
                    div2.innerText=data[i].store_name;
                    div3.innerText="평점:"+ data[i].avger_star + "리뷰 수 :" + data[i].cou;
                    div4.innerText="최소 배달금액"+data[i].store_detail_minimum_price;
                    div.append(div1);
                    div.append(div2);
                    div.append(div3);
                    div.append(div4);
                    form.append(div);
                    $('#storeListDiv').append(form);
                }
            }
            resultdata=data;
        }).fail(function (error) {
            alert(JSON.stringify(error));
        });
    }
</script>
</body>
</html>