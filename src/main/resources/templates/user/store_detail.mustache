<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
<body>
{{>layout/main/main_header}}
    {{#type}}
        <div><a href="/user/store/{{categoryKo}}/{{selectStore.store_category}}/{{type}}"><-</a></div>
    {{/type}}
    {{^type}}
        <div><a href="/user/category/click/{{categoryKo}}/{{selectStore.store_category}}"><-</a></div>
    {{/type}}
    <hr>
    <div id="top">
        <img src="{{selectStore.store_detail_info_img}}" class="img-fluid">
        <hr>
        <ul>
            <li>{{selectStore.store_name}}</li>
            <li>
                {{#selectStore.starAvg}}
                    {{selectStore.starAvg}}
                {{/selectStore.starAvg}}
                {{^selectStore.starAvg}}
                    0
                {{/selectStore.starAvg}}
            </li>
            <li>최근 리뷰 {{selectStoreReview.commentCnt}} | 최근사장님댓글 {{selectStoreReview.replyCnt}}</li>
        </ul>
    </div>
    <hr>
    <div id="middle">
        <ul class="nav justify-content-center">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#" id="deliverTap">배달 주문</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" id="visitTap">포장/방문주문</a>
            </li>
        </ul>
        <hr>
        <ul id="deliveryOrder" style="display: block">
            <li>최소 주문 금액 : {{selectStore.store_detail_minimum_price}}</li>
            <li>결제 방법 : 바로 결제, 만나서 결제</li>
            <li>배달팁 : {{selectStore.store_detail_deliver_price}}</li>
        </ul>
        <ul id="visitOrder" style="display: none">
            <li>최소주문금액 : 없음</li>
            <li>이용 방법 : 매장, 포장</li>
            <li>
                위치 안내 : {{selectStore.store_basic_addr}} {{selectStore.store_detail_addr}}
                            지도 들어가야 함
            </li>
            <li>결제 방법 : 바로 결제</li>
        </ul>
    </div>
    <hr>
    <div id="under">
        <ul class="nav justify-content-center">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#" id="menuTap">메뉴</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" id="infoTap">정보</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" id="reviewTap">리뷰</a>
            </li>
        </ul>
        <hr>
        <div id="menuTapList" style="display: block">
            <div id="menuText">
                {{selectStore.store_detail_menu_text}}
            </div>
            <hr>
            <div id="menuList">
                <h4>대표 메뉴</h4>
                {{#kingMenu}}
                    <a href="/user/store/menu/detail/{{menu_idx}}/{{categoryKo}}" class="link-secondary">
                        <div class="card mb-3" style="max-width: 750px;">
                            <div class="row g-0">
                                <div class="col-md-4">
                                    <img src="C:\이젠\upload\" class="img-fluid rounded-start" alt="...">
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body">
                                        <h5 class="card-title">{{menu_name}}</h5>
                                        <p class="card-text"><small class="text-muted">
                                            {{menu_price}}원</small>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                {{/kingMenu}}

                <h4>메뉴 소개</h4>
                {{#menuList}}
                    <a href="/user/store/menu/detail/{{menu_idx}}/{{categoryKo}}" class="link-secondary">
                        <div class="card mb-3" style="max-width: 750px;">
                            <div class="row g-0">
                                <div class="col-md-4">
                                    <img src="C:\이젠\upload\" class="img-fluid rounded-start" alt="...">
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body">
                                        <h5 class="card-title">{{menu_name}}</h5>
                                        <p class="card-text"><small class="text-muted">
                                            {{menu_price}}원</small>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                {{/menuList}}
            </div>
        </div>

        <div id="infoTapList" style="display: none">
            <div>
                {{selectStore.store_detail_info_text}}
            </div>
        </div>

        <div id="reviewTapList" style="display: none">
            <div id="reviewText">
                <div>
                    {{#selectStore.starAvg}}
                    별점 : {{selectStore.starAvg}}
                    {{/selectStore.starAvg}}
                    {{^selectStore.starAvg}}
                        0
                    {{/selectStore.starAvg}}
                </div>
                <div>
                    사장님 한마디 : {{selectStore.store_detail_review_text}}
                </div>
            </div>
            <hr>
            <input type="hidden" id="store_idx" value="{{selectStore.store_idx}}">
            <div id="reviewList">
            </div>
        </div>
    </div>
    {{>user/shopping_visible}}
{{>layout/main/main_footer}}
</body>
<script>

    //  배달/포장방문 탭
    let deliverTap = document.getElementById('deliverTap');
    deliverTap.click();

    document.getElementById('visitTap').addEventListener('click', () => {
        document.getElementById('deliveryOrder').style.display = 'none';
        document.getElementById('visitOrder').style.display = 'block';
    })

    deliverTap.addEventListener('click', () => {
        document.getElementById('deliveryOrder').style.display = 'block';
        document.getElementById('visitOrder').style.display = 'none';
    })

    //  메뉴/정보/리뷰 탭
    document.getElementById('menuTap').addEventListener('click', () => {
        document.getElementById('menuTapList').style.display = 'block';
        document.getElementById('infoTapList').style.display = 'none';
        document.getElementById('reviewTapList').style.display = 'none';
    })

    document.getElementById('infoTap').addEventListener('click', () => {
        document.getElementById('menuTapList').style.display = 'none';
        document.getElementById('infoTapList').style.display = 'block';
        document.getElementById('reviewTapList').style.display = 'none';
    })

    document.getElementById('reviewTap').addEventListener('click', () => {
        document.getElementById('menuTapList').style.display = 'none';
        document.getElementById('infoTapList').style.display = 'none';
        document.getElementById('reviewTapList').style.display = 'block';

        //해당 가게 리뷰 리스트 불러오기
         let store_idx = document.getElementById('store_idx').value;

        fetch(`/user/store/detail/review/${store_idx}`)
        .then((response) => response.json())
        .then((datas) => {
            datas.data.forEach( (data, idx) => {
                let api_date = data.review_write_date;
                let timestamp = api_date;
                let date = new Date(timestamp);
                let review_write_date = date.toLocaleDateString();

                let sd_review_List = '';
                if(data.review_img1 != null){
                    sd_review_List += `<div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                                            <div class="carousel-inner">`
                            sd_review_List += `<div class="carousel-item active">
                                                  <img src="${data.review_img1}" class="d-block w-100" alt="...">
                                               </div>`
                    if(data.review_img2 != null){
                            sd_review_List += `<div class="carousel-item active">
                                                  <img src="${data.review_img2}" class="d-block w-100" alt="...">
                                               </div>`
                        if(data.review_img3 != null){
                            sd_review_List += `<div class="carousel-item active">
                                                    <img src="${data.review_img3}" class="d-block w-100" alt="...">
                                               </div>`
                        }
                    }
                        sd_review_List += `</div>
                                          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Previous</span>
                                          </button>
                                          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Next</span>
                                          </button>
                                      </div>`
                }

                sd_review_List += `<div class="mb-3 row">
                                    <label for="staticEmail" class="col-sm-2 col-form-label">닉네임</label>
                                    <div class="col-sm-10">
                                      <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="${data.user_nickname}">
                                    </div>
                                  </div>`
                sd_review_List += `<div class="mb-3 row">
                                    <label for="staticEmail" class="col-sm-2 col-form-label">별점</label>
                                    <div class="col-sm-10">
                                      <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="${data.review_star}">
                                    </div>
                                  </div>`
                sd_review_List += `<div class="mb-3 row">
                                    <label for="staticEmail" class="col-sm-2 col-form-label">작성 날짜</label>
                                    <div class="col-sm-10">
                                      <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="${review_write_date}">
                                    </div>
                                  </div>`
                sd_review_List += `<div class="mb-3 row">
                                    <label for="staticEmail" class="col-sm-2 col-form-label">리뷰</label>
                                    <div class="col-sm-10">
                                      <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="${data.review_comment}">
                                    </div>
                                  </div>`
                if(data.review_reply != null){
                    sd_review_List += `<div class="mb-3 row">
                                        <label for="staticEmail" class="col-sm-2 col-form-label">사장님 답변</label>
                                        <div class="col-sm-10">
                                          <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="${data.review_reply}">
                                        </div>
                                      </div>
                                      <hr>`
                }else{
                    sd_review_List += `<hr>`
                }
                // sd_review_List += `<div>닉네임:${data.user_nickname}</div>
                //                         <div>별점:${data.review_star}</div>
                //                         <div>작성 날짜:${review_write_date}</div>
                //                         <div>리뷰:${data.review_comment}</div>`
                // if(data.review_reply != null){
                //     sd_review_List += `<div>사장님 답변:${data.review_reply}</div>
                //                         <hr>`
                // }else{
                //     sd_review_List += `<hr>`
                // }
                let div_sd_review_List = document.createElement('div');
                div_sd_review_List.innerHTML = sd_review_List;
                document.getElementById('reviewList').appendChild(div_sd_review_List);
            })
        })

    })

</script>
</html>